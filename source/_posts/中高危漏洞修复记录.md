# 中高危漏洞修复记录

## 一.高危漏洞

### 1.Apache Velocity 远程代码执行漏洞(CVE-2020-13936)

- 漏洞编码：CVE-2020-13936

- 修复建议：将 Velocity 升级到 2.3 及以上版本，下载地址：https://velocity.apache.org/download.cgi

- 修复过程：当前项目使用的是spring-boot和velocity的整合(spring-boot-starter-velocity)，而spring-boot-starter-velocity最新的版本是1.4.7，此版本对应的velocity版本是1.7。后续高版本的spring-boot不再支持。所以只能不使用spring-boot和velocity的整合，手动引入velocity

```
<dependency>
    <groupId>org.apache.velocity</groupId>
    <artifactId>velocity</artifactId>
    <version>2.3</version>
</dependency>
<dependency>
    <groupId>org.apache.velocity</groupId>
    <artifactId>velocity-tools</artifactId>
    <version>2.3</version>
</dependency>
```

> 注：实际项目未使用到velocity业务，通过排包的方式解决

### 2.XStream 拒绝服务漏洞(CVE-2022-41966)

- 漏洞编码：CVE-2020-13936

- 修复建议：将 XStream 升级到 1.4.20 及以上版本，下载地址：http://x-stream.github.io/download.html

- 修复过程：pom中升级引入的XStream版本到1.4.20版本

### 3.Spring Framework 身份认证绕过漏洞(CVE-2023-20860)

- 漏洞编码：CVE-2023-20860

- 修复建议：将 Spring Framework 升级到 5.3.26、6.0.7 及以上版本，下载地址：https://github.com/spring-projects/spring-framework/releases

- 修复过程：pom中修改引入的org.springframework版本到5.2.12.RELEASE

- 注：Spring Framework 5.3.x之前的版本不受影响

### 5.Nacos 未授权访问漏洞(CVE-2021-29441)

- 漏洞编码：CVE-2021-29441

- 修复建议：确保Nacos访问安全，仅允许白名单IP进行访问

### 6.Spring Security 身份验证绕过漏洞(CVE-2024-22257)

- 漏洞编码：CVE-2024-22257

- 修复建议：将 Spring Security 升级到 5.7.12、5.8.11、6.0.10、6.1.8、6.2.3 及以上版本，下载地址：https://github.com/spring-projects/spring-security/releases

### 7.Apache Commons FileUpload 拒绝服务漏洞(CVE-2023-24998)

- 漏洞编码：CVE-2023-24998

- 修复建议：将 Commons FileUpload 升级到 1.5 及以上版本，下载地址：https://commons.apache.org/proper/commons-fileupload/download_fileupload.cgi\
  
  > 注：实际项目未使用到此业务，通过排包的方式解决
  
  ![](https://gitee.com/fanzhendong/my-blog-image/raw/master/img/20240517144852.png)

### 8.Apache Commons FileUpload 拒绝服务漏洞(CVE-2023-24998)

- 漏洞编码：CVE-2023-24998

- 修复建议：将 Commons FileUpload 升级到 1.5 及以上版本，下载地址：https://commons.apache.org/proper/commons-fileupload/download_fileupload.cgi

- 修复过程：排查相关包

```
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-dubbo</artifactId>
    <exclusions>
        <exclusion>
            <artifactId>commons-fileupload</artifactId>
            <groupId>commons-fileupload</groupId>
        </exclusion>
    </exclusions> 
</dependency> 
```

> 注：实际项目未使用到此业务，通过排包的方式解决

### 9.FastJSON＜=1.2.80 反序列化漏洞(CVE-2022-25845)

- 漏洞编码：CVE-2022-25845

- 修复建议：1.将 FastJSON 升级到 1.2.83 及以上版本，或noneautotype版本，下载地址：https://repo1.maven.org/maven2/com/alibaba/fastjson/
  2.临时修复建议：开启了autoType功能的受影响用户可通过关闭autoType来规避风险，另建议将JDK升级到最新版本。
     由于autotype开关的限制可被绕过，请受影响用户升级到FastJSON 1.2.68及以上版本，通过开启safeMode配置完全禁用autoType。三种配置SafeMode的方式如下:
    1）在代码中配置： ParserConfig.getGlobalInstance().setSafeMode(true);
    2）加上JVM启动参数： -Dfastjson.parser.safeMode=true （如果有多个包名前缀，可用逗号隔开）
    3）通过类路径的fastjson.properties文件来配置： fastjson.parser.safeMode=true

- 修复过程：fastjson版本升级到1.2.83

![]()

- ### 10.Spring Boot 拒绝服务漏洞(CVE-2023-20883)

- 漏洞编码：CVE-2023-20883

- 修复建议：将 Spring Boot 升级到 2.5.15、2.6.15、2.7.12、3.0.7 及以上版本，下载地址：https://github.com/spring-projects/spring-boot/releases

- 修复过程：spring-boot版本升级到2.7.12

### 11.SnakeYAML 反序列化漏洞(CVE-2022-1471)

- 漏洞编码：CVE-2022-1471

- 修复建议：将 snakeyaml 升级到 2.0 及以上版本，下载地址：https://mvnrepository.com/artifact/org.yaml/snakeyaml

- 修复过程：升级版本

## 二.中危漏洞

### 1.Spring Framework反射型文件下载漏洞(CVE-2020-5421)

- 漏洞编码：CVE-2020-5421

- 修复建议：将 Spring 升级到 4.3.29、5.0.19、5.1.18、5.2.9及以上版本，下载地址：
  https://github.com/spring-projects/spring-framework/releases
  https://mvnrepository.com/artifact/org.springframework/spring-core

- 修复过程：rocketmq版本升级

### 2.Apache Dubbo 远程代码执行漏洞(CVE-2023-23638)

- 漏洞编码：CVE-2023-23638

- 修复建议：将 Dubbo 升级到 2.7.22、3.0.14、3.1.6 及以上版本，下载地址：https://github.com/apache/dubbo/releases

- 修复过程：升级dubbo版本到2.7.23

### 3.Oracle MySQL JDBC XXE漏洞(CVE-2021-2471)

- 漏洞编码：CVE-2021-2471

- 修复建议：将 mysql-connector-java 升级到 8.0.27 及以上版本，下载地址：https://mvnrepository.com/artifact/mysql/mysql-connector-java

- 修复过程：升级到mysql-connector-java 8.0.27版本

### 4.Logback 远程代码执行漏洞(CVE-2021-42550)

- 漏洞编码：CVE-2021-42550

- 修复建议：将 Logback  升级到 1.2.9 及以上版本，下载地址：https://logback.qos.ch/download.html

- 修复过程：springboot集成了logback，我们只升级lomback不升级springboot，在项目pom中升级logback版本号

```
<dependency>  
    <groupId>ch.qos.logback</groupId>  
    <artifactId>logback-classic</artifactId>  
    <version>新版本号</version>  
</dependency>
```

## 三.修改记录

1.yml

```
<spring-boot-dependencies.version>2.7.12</spring-boot-dependencies.version>

<xstream-version>1.4.20</xstream-version>

<!--logback日志框架-->
<logback.version>1.2.9</logback.version>
<!--snakeyaml-->
<snakeyaml.version>2.0</snakeyaml.version>


<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-classic</artifactId>
    <version>${logback.version}</version>
</dependency>
<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-core</artifactId>
    <version>${logback.version}</version>
</dependency>
<dependency>
    <groupId>org.yaml</groupId>
    <artifactId>snakeyaml</artifactId>
    <version>${snakeyaml.version}</version>
    <scope>runtime</scope>
</dependency>



<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-dubbo</artifactId>
    <exclusions>
        <exclusion>
            <artifactId>commons-fileupload</artifactId>
            <groupId>commons-fileupload</groupId>
        </exclusion>
    </exclusions>
</dependency>



<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <scope>test</scope>
    <version>8.0.27</version>
</dependency>
```
